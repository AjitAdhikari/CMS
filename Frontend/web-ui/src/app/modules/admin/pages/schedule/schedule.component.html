<div class="schedule-container">
    <div class="schedule-header">
        <div class="header-content">
            <h1 class="page-title">Schedule Management</h1>
            <p class="page-subtitle">Manage class schedules for all courses and faculties</p>
        </div>
        <button class="btn btn-primary" (click)="openAddModal()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
            Add Schedule
        </button>
    </div>

    <div *ngIf="successMessage" class="alert alert-success">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" />
        </svg>
        {{ successMessage }}
    </div>

    <div *ngIf="errorMessage" class="alert alert-danger">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" />
            <path d="M12 8v4M12 16h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
        {{ errorMessage }}
    </div>

    <div *ngIf="isLoading" class="loading-state">
        <div class="spinner"></div>
        <p>Loading schedules...</p>
    </div>

    <div *ngIf="!isLoading" class="schedules-grid">
        <div *ngIf="schedules.length === 0" class="empty-state">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor" stroke-width="1.5" />
                <path d="M7 9h10M7 13h10M7 17h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
            </svg>
            <h3>No schedules available</h3>
            <p>Click "Add Schedule" to create a new class schedule</p>
        </div>

        <div *ngIf="schedules.length > 0" class="table-container">
            <table class="schedules-table">
                <thead>
                    <tr>
                        <th>Course</th>
                        <th>Faculty</th>
                        <th>Class Date</th>
                        <th>Time & Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let schedule of schedules">
                        <td>
                            <div class="course-cell">
                                <span class="course-name-text">{{ schedule.courseName }}</span>
                                <span class="course-id">ID: {{ schedule.course_id }}</span>
                            </div>
                        </td>
                        <td>{{ schedule.facultyName }}</td>
                        <td>{{ schedule.class_date }}</td>
                        <td>
                            <span class="time-text">{{ schedule.start_time || '--:--' }} - {{ schedule.end_time ||
                                '--:--' }}</span>
                            <span class="status-badge" style="margin-left:0.75rem; vertical-align:middle;"
                                [ngClass]="{'active': schedule.status === 'active', 'inactive': schedule.status !== 'active'}">
                                {{ schedule.status | titlecase }}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon" title="Edit Schedule" (click)="openEditModal(schedule)">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"
                                            stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round" />
                                        <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"
                                            stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round" />
                                    </svg>
                                </button>
                                <button class="btn-icon danger" title="Delete Schedule"
                                    (click)="deleteSchedule(schedule)">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"
                                            stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round" />
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add Schedule Modal -->
<div *ngIf="showAddModal" class="modal-overlay" (click)="closeAddModal()">
    <div class="modal-content modal-lg" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Add New Schedule</h2>
            <button class="close-btn" (click)="closeAddModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </button>
        </div>

        <form [formGroup]="scheduleForm" class="modal-form">
            <div class="form-group">
                <label for="courseId">Course *</label>
                <select id="courseId" formControlName="course_id" class="form-control">
                    <option value="">Select a course</option>
                    <option *ngFor="let course of courses" [value]="course.id">{{ course.name }}</option>
                </select>
            </div>

            <div class="form-group">
                <label for="facultyId">Faculty *</label>
                <select id="facultyId" formControlName="faculty_id" class="form-control">
                    <option value="">Select a faculty</option>
                    <option *ngFor="let faculty of faculties" [value]="faculty.id">{{ faculty.name }}</option>
                </select>
            </div>

            <div class="form-group">
                <label for="classDate">Class Date *</label>
                <input type="date" id="classDate" formControlName="class_date" class="form-control" />
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="startTime">Start Time *</label>
                    <input type="time" id="startTime" formControlName="start_time" class="form-control" />
                    <div style="display:flex;align-items:center;gap:0.5rem;margin-top:0.5rem;">
                        <input type="checkbox" id="isActiveAdd" formControlName="isActive" />
                        <label for="isActiveAdd" style="margin:0">Active Schedule</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="endTime">End Time *</label>
                    <input type="time" id="endTime" formControlName="end_time" class="form-control" />
                </div>
            </div>
        </form>

        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeAddModal()">Cancel</button>
            <button type="button" class="btn btn-primary" (click)="createSchedule()"
                [disabled]="scheduleForm.invalid">Create
                Schedule</button>
        </div>
    </div>
</div>

<div *ngIf="showEditModal && selectedSchedule" class="modal-overlay" (click)="closeEditModal()">
    <div class="modal-content modal-lg" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Edit Schedule</h2>
            <button class="close-btn" (click)="closeEditModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </button>
        </div>

        <div class="modal-info">
            <strong>Note:</strong> Course selection is locked. You can modify other details.
        </div>

        <form [formGroup]="editForm" class="modal-form">
            <div class="form-group">
                <label for="courseIdEdit">Course ID</label>
                <input type="number" id="courseIdEdit" formControlName="course_id" class="form-control" readonly />
            </div>

            <div class="form-group">
                <label for="courseNameEdit">Course Name</label>
                <input type="text" id="courseNameEdit" formControlName="courseName" class="form-control" readonly />
            </div>

            <div class="form-group">
                <label for="facultyIdEdit">Faculty *</label>
                <select id="facultyIdEdit" formControlName="faculty_id" class="form-control">
                    <option value="">Select a faculty</option>
                    <option *ngFor="let faculty of faculties" [value]="faculty.id">{{ faculty.name }}</option>
                </select>
            </div>

            <div class="form-group">
                <label for="classDateEdit">Class Date *</label>
                <input type="date" id="classDateEdit" formControlName="class_date" class="form-control" />
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="startTimeEdit">Start Time *</label>
                    <input type="time" id="startTimeEdit" formControlName="start_time" class="form-control" />
                    <div style="display:flex;align-items:center;gap:0.5rem;margin-top:0.5rem;">
                        <input type="checkbox" id="isActiveEdit" formControlName="isActive" />
                        <label for="isActiveEdit" style="margin:0">Active Schedule</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="endTimeEdit">End Time *</label>
                    <input type="time" id="endTimeEdit" formControlName="end_time" class="form-control" />
                </div>
            </div>
        </form>

        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
            <button type="button" class="btn btn-primary" (click)="updateSchedule()">Update Schedule</button>
        </div>
    </div>
</div>